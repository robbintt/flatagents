{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$ref": "#/definitions/AgentWrapper",
  "definitions": {
    "AgentWrapper": {
      "type": "object",
      "properties": {
        "spec": {
          "type": "string",
          "const": "flatagent"
        },
        "spec_version": {
          "type": "string"
        },
        "data": {
          "$ref": "#/definitions/AgentData"
        },
        "metadata": {
          "type": "object"
        }
      },
      "required": [
        "spec",
        "spec_version",
        "data"
      ],
      "additionalProperties": false
    },
    "AgentData": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "model": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "$ref": "#/definitions/ModelConfig"
            },
            {
              "$ref": "#/definitions/ProfiledModelConfig"
            }
          ]
        },
        "system": {
          "type": "string"
        },
        "user": {
          "type": "string"
        },
        "instruction_suffix": {
          "type": "string"
        },
        "output": {
          "$ref": "#/definitions/OutputSchema"
        },
        "mcp": {
          "$ref": "#/definitions/MCPConfig"
        }
      },
      "required": [
        "model",
        "system",
        "user"
      ],
      "additionalProperties": false
    },
    "ModelConfig": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "provider": {
          "type": "string"
        },
        "temperature": {
          "type": "number"
        },
        "max_tokens": {
          "type": "number"
        },
        "top_p": {
          "type": "number"
        },
        "top_k": {
          "type": "number"
        },
        "frequency_penalty": {
          "type": "number"
        },
        "presence_penalty": {
          "type": "number"
        },
        "seed": {
          "type": "number"
        },
        "base_url": {
          "type": "string"
        }
      },
      "required": [
        "name"
      ],
      "additionalProperties": false
    },
    "ProfiledModelConfig": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "provider": {
          "type": "string"
        },
        "temperature": {
          "type": "number"
        },
        "max_tokens": {
          "type": "number"
        },
        "top_p": {
          "type": "number"
        },
        "top_k": {
          "type": "number"
        },
        "frequency_penalty": {
          "type": "number"
        },
        "presence_penalty": {
          "type": "number"
        },
        "seed": {
          "type": "number"
        },
        "base_url": {
          "type": "string"
        },
        "profile": {
          "type": "string"
        }
      },
      "required": [
        "profile"
      ],
      "additionalProperties": false
    },
    "OutputSchema": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/OutputFieldDef"
      }
    },
    "OutputFieldDef": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "str",
            "int",
            "float",
            "bool",
            "json",
            "list",
            "object"
          ]
        },
        "description": {
          "type": "string"
        },
        "enum": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "required": {
          "type": "boolean"
        },
        "items": {
          "$ref": "#/definitions/OutputFieldDef"
        },
        "properties": {
          "$ref": "#/definitions/OutputSchema"
        }
      },
      "required": [
        "type"
      ],
      "additionalProperties": false
    },
    "MCPConfig": {
      "type": "object",
      "properties": {
        "servers": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/MCPServerDef"
          }
        },
        "tool_filter": {
          "$ref": "#/definitions/ToolFilter"
        },
        "tool_prompt": {
          "type": "string"
        }
      },
      "required": [
        "servers",
        "tool_prompt"
      ],
      "additionalProperties": false
    },
    "MCPServerDef": {
      "type": "object",
      "properties": {
        "command": {
          "type": "string"
        },
        "args": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "env": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "server_url": {
          "type": "string"
        },
        "headers": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "timeout": {
          "type": "number"
        }
      },
      "additionalProperties": false
    },
    "ToolFilter": {
      "type": "object",
      "properties": {
        "allow": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "deny": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    }
  }
}

# FlatAgent Search Refiner - Step 2: Refiner Agent
# Refines search results down to max output_tokens of most relevant information

spec: flatagent
spec_version: "0.6.0"

data:
  name: refiner-agent

  model:
    provider: cerebras
    name: zai-glm-4.6
    temperature: 1.0
    max_tokens: 4096
    output_tokens: 500

  system: |
    You are a content refiner and summarizer. Your task is to extract the most relevant information from search results.

    TOKEN BUDGET: You have {{ model.max_tokens - model.output_tokens }} tokens for thinking/reasoning, then {{ model.output_tokens }} tokens for your final output.

    Your constraints:
    1. Maximum output: {{ model.output_tokens }} tokens
    2. Preserve accuracy - only include factual information from the source
    3. Focus on information most relevant to the original search query
    4. Maintain source attribution when possible
    5. Be concise but complete

    Format your response as:
    - Key findings (2-3 most important points)
    - Supporting details
    - Sources (brief references)

  user: |
    Original search query: {{ input.query }}

    Search results to refine:
    {{ input.search_results }}

    Refine to â‰¤{{ model.output_tokens }} tokens.

metadata:
  description: "Refiner agent that condenses search results to most relevant information"
  tags: ["refine", "summarize", "context-management"]

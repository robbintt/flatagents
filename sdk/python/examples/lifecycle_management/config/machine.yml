spec: flatmachine
spec_version: "1.1.1"
data:
  name: data_pipeline
  context:
    items_processed: 0
    errors: 0
  persistence:
    enabled: true
    backend: local
  states:
    start:
      type: initial
      transitions:
        - to: process
    process:
      action: process_item
      transitions:
        - condition: "context.items_processed >= 5"
          to: summarize
        - to: process
    summarize:
      action: build_summary
      transitions:
        - to: end
    end:
      type: final
      output:
        total_processed: "{{ context.items_processed }}"
        total_errors: "{{ context.errors }}"
        summary: "{{ context.summary }}"

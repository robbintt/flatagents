spec: flatmachine
spec_version: "0.8.0"
data:
  name: worker_task
  profiles: ./profiles.yml
  context:
    task: "{{ input.task }}"
    data: "{{ input.data }}"
    raw_result: null
  agents:
    worker: ./worker.yml
    result_extractor: ./result_extractor.yml
  states:
    run_task:
      type: initial
      agent: worker
      input:
        task: "{{ context.task }}"
        data: "{{ context.data }}"
      output_to_context:
        raw_result: "{{ output.content }}"
      transitions:
        - to: extract_result
    extract_result:
      agent: result_extractor
      execution:
        type: retry
        backoffs: [2, 8, 16, 35]
        jitter: 0.1
      input:
        text: "{{ context.raw_result }}"
      output_to_context:
        result: "{{ output.result }}"
      transitions:
        - to: done
    done:
      type: final
      output:
        result: "{{ context.result }}"

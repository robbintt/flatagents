# Analyzer Peer Machine
# Extracts key information from paper abstract and sections
# Contains 2 agents: abstract_analyzer and section_analyzer

spec: flatmachine
spec_version: "1.0.0"

data:
  name: analyzer
  profiles: ./profiles.yml
  
  context:
    title: "{{ input.title }}"
    authors: "{{ input.authors }}"
    abstract: "{{ input.abstract }}"
    section_text: "{{ input.section_text }}"
    # Full text outputs from agents
    abstract_analysis: null
    section_analysis: null
  
  agents:
    abstract_analyzer: ./abstract_analyzer.yml
    section_analyzer: ./section_analyzer.yml
  
  states:
    start:
      type: initial
      transitions:
        - to: analyze_abstract

    analyze_abstract:
      agent: abstract_analyzer
      execution:
        type: retry
        backoffs: [2, 8]
      input:
        title: "{{ context.title }}"
        authors: "{{ context.authors }}"
        abstract: "{{ context.abstract }}"
      output_to_context:
        abstract_analysis: content
      transitions:
        - to: analyze_sections

    analyze_sections:
      agent: section_analyzer
      execution:
        type: retry
        backoffs: [2, 8]
      input:
        title: "{{ context.title }}"
        key_findings: "{{ context.abstract_analysis }}"
        section_text: "{{ context.section_text }}"
      output_to_context:
        section_analysis: content
      transitions:
        - to: done

    done:
      type: final
      output:
        abstract_analysis: "{{ context.abstract_analysis }}"
        section_analysis: "{{ context.section_analysis }}"

metadata:
  description: "Peer machine for paper content analysis"
